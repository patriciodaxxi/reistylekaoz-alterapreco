unit Principal;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.Menus, Vcl.StdCtrls, Vcl.ExtCtrls,
  Vcl.Buttons, Data.DB, Vcl.Grids, Vcl.DBGrids;

type
  TdrmPrincipal = class(TForm)
    btnListar: TSpeedButton;
    btnSalvar: TSpeedButton;
    cmbConsulta: TComboBox;
    RadioGroup1: TRadioGroup;
    edtID: TEdit;
    edtNome: TEdit;
    SpeedButton1: TSpeedButton;
    grid: TDBGrid;
    DS: TDataSource;
    Panel1: TPanel;
    edtPerc: TEdit;
    Label1: TLabel;
    btnPerc: TSpeedButton;
    procedure listarprodutos;
    procedure ajustarpercentual;
    procedure btnListarClick(Sender: TObject);
    procedure btnPercClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  drmPrincipal: TdrmPrincipal;

implementation

{$R *.dfm}

uses Modulo;

procedure TdrmPrincipal.ajustarpercentual;
VAR
perc: Double;
begin
  while dmod.Qry.Eof do
  begin
     perc := (dmod.Qry.FieldByName('VALOR_PRO').Value * StrToFloat(edtPerc.Text)) / 100;
     ds.;
     dmod.Qry.Next;
     perc := 0;
  end;

end;

procedure TdrmPrincipal.btnListarClick(Sender: TObject);
begin
   listarprodutos;
end;

procedure TdrmPrincipal.btnPercClick(Sender: TObject);
begin
ajustarpercentual;
listarprodutos;
end;

procedure TdrmPrincipal.listarprodutos;
begin
  DMod.Qry.SQL.Clear;
  DMod.Qry.SQL.Add
    ('select p.cod_pro, p.nome_pro, p.valor_pro, e.estoque, c.preco_custo from produto p');
  DMod.Qry.SQL.Add('left join Estoque e on(p.cod_pro = e.cod_pro)');
  DMod.Qry.SQL.Add('left join custos c on(p.cod_pro = c.cod_pro)');
  DMod.Qry.SQL.Add(' where p.cod_sec = :pesquisa');
  DMod.Qry.ParamByName('pesquisa').Value := edtID.Text;
  DMod.Qry.Open;
  grid.Columns[0].FieldName := 'COD_PRO';
  grid.Columns[1].FieldName := 'NOME_PRO';
  grid.Columns[2].FieldName := 'VALOR_PRO';
  GRID.Columns[0].Width := 60;
  GRID.Columns[1].Width := 460;
  GRID.Columns[2].Width := 60;


end;

end.
